import{a as d}from"./index-t--hEgTQ.js";import{c,a as s,g,F as w,i as k,t as m,h as v,v as _,b as i,w as I,r as y,f as x,o as u,e as C,n as b}from"./index-1lhg6rTc.js";import{_ as q}from"./plugin-vueexport-helper-DlAUqK2U.js";const U={data(){return{products:[],product:{},status:{loadingItem:""},form:{user:{name:"",email:"",tel:"",address:""},message:""},cart:{},coupon_code:""}},methods:{async getProducts(){const e="https://vue3-course-api.hexschool.io/api/rosie-api/products/all",t=this.$loading.show(),a=await d.get(e);this.products=a.data.products,console.log("products:",a),t.hide()},async addCart(e){const t="https://vue3-course-api.hexschool.io/api/rosie-api/cart";this.status.loadingItem=e;const a={product_id:e,qty:1},n=await d.post(t,{data:a});this.status.loadingItem="",console.log(n),this.getCart(),x.emit("update-cart")},getProduct(e){this.$router.push(`/product/${e}`)},async getCart(){const e="https://vue3-course-api.hexschool.io/api/rosie-api/cart",t=this.$loading.show(),a=await d.get(e);console.log(a),this.cart=a.data.data,t.hide()},async updateCart(e){const t=`https://vue3-course-api.hexschool.io/api/rosie-api/cart/${e.id}`,a=this.$loading.show();this.status.loadingItem=e.id;const n={product_id:e.product_id,qty:e.qty},o=await d.put(t,{data:n});a.hide(),console.log(o),this.status.loadingItem="",this.getCart(),x.emit("update-cart")},async removeCartItem(e){this.status.loadingItem=e;const t=`https://vue3-course-api.hexschool.io/api/rosie-api/cart/${e}`,a=this.$loading.show(),n=await d.delete(t);this.$httpMessageState(n,"移除購物車品項"),this.status.loadingItem="",this.getCart(),a.hide(),x.emit("update-cart")},async addCouponCode(){const e="https://vue3-course-api.hexschool.io/api/rosie-api/coupon",t={code:this.coupon_code},a=this.$loading.show(),n=await d.post(e,{data:t});this.$httpMessageState(n,"加入優惠券"),this.getCart(),a.hide()},async createOrder(){const e="https://vue3-course-api.hexschool.io/api/rosie-api/order",t=this.form,a=await d.post(e,{data:t});if(console.log(a),a.data.success){const n=a.data.orderId;this.$router.push(`/user/checkout/${n}`)}}},created(){this.getProducts(),this.getCart()}},$={class:"container"},F={class:"row mt-4"},E={class:"col-md-6 mb-4"},M={class:"sticky-top"},S={class:"table align-middle"},A=["disabled","onClick"],N={key:0,class:"text-success"},B={class:"input-group input-group-sm"},P=["onUpdate:modelValue","onChange","disabled"],D={class:"input-group-text"},O={class:"text-end"},T={key:0,class:"text-success"},z={class:"text-end"},L={key:0},j={class:"text-end text-success"},G={class:"input-group mb-3 input-group-sm"},H={class:"col-md-6"},J={class:"mb-3"},K={class:"mb-3"},Q={class:"mb-3"},R={class:"mb-3"},W={class:"mb-3"};function X(e,t,a,n,o,p){const h=y("AppField"),f=y("ErrorMessage"),V=y("AppForm");return u(),c("div",$,[s("div",F,[s("div",E,[s("div",M,[s("table",S,[t[10]||(t[10]=s("thead",null,[s("tr",null,[s("th"),s("th",null,"品名"),s("th",{style:{width:"110px"}},"數量"),s("th",null,"單價")])],-1)),s("tbody",null,[o.cart.carts?(u(!0),c(w,{key:0},k(o.cart.carts,l=>(u(),c("tr",{key:l.id},[s("td",null,[s("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:o.status.loadingItem===l.id,onClick:r=>p.removeCartItem(l.id)},t[7]||(t[7]=[s("i",{class:"bi bi-trash-fill"},null,-1)]),8,A)]),s("td",null,[C(m(l.product.title)+" ",1),l.coupon?(u(),c("div",N,"已套用優惠券")):g("",!0)]),s("td",null,[s("div",B,[v(s("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":r=>l.qty=r,onChange:r=>p.updateCart(l),disabled:l.id===o.status.loadingItem},null,40,P),[[_,l.qty,void 0,{number:!0}]]),s("div",D,"/ "+m(l.product.unit),1)])]),s("td",O,[o.cart.final_total!==o.cart.total?(u(),c("small",T,"折扣價：")):g("",!0),C(" "+m(e.$filters.currency(l.final_total)),1)])]))),128)):g("",!0)]),s("tfoot",null,[s("tr",null,[t[8]||(t[8]=s("td",{colspan:"3",class:"text-end"},"總計",-1)),s("td",z,m(e.$filters.currency(o.cart.total)),1)]),o.cart.final_total!==o.cart.total?(u(),c("tr",L,[t[9]||(t[9]=s("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1)),s("td",j,m(e.$filters.currency(o.cart.final_total)),1)])):g("",!0)])]),s("div",G,[v(s("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=l=>o.coupon_code=l),placeholder:"請輸入優惠碼"},null,512),[[_,o.coupon_code]]),s("button",{class:"btn btn-outline-secondary",type:"button",onClick:t[1]||(t[1]=(...l)=>p.addCouponCode&&p.addCouponCode(...l))}," 套用優惠碼 ")])])]),s("div",H,[i(V,{class:"col-12",onSubmit:p.createOrder},{default:I(({errors:l})=>[s("div",J,[t[11]||(t[11]=s("label",{for:"email",class:"form-label"},"Email",-1)),i(h,{id:"email",name:"email",type:"email",class:b(["form-control",{"is-invalid":l.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:o.form.user.email,"onUpdate:modelValue":t[2]||(t[2]=r=>o.form.user.email=r)},null,8,["class","modelValue"]),i(f,{name:"email",class:"invalid-feedback"})]),s("div",K,[t[12]||(t[12]=s("label",{for:"name",class:"form-label"},"收件人姓名",-1)),i(h,{id:"name",name:"姓名",type:"text",class:b(["form-control",{"is-invalid":l.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:o.form.user.name,"onUpdate:modelValue":t[3]||(t[3]=r=>o.form.user.name=r)},null,8,["class","modelValue"]),i(f,{name:"姓名",class:"invalid-feedback"})]),s("div",Q,[t[13]||(t[13]=s("label",{for:"tel",class:"form-label"},"收件人電話",-1)),i(h,{id:"tel",name:"電話",type:"tel",class:b(["form-control",{"is-invalid":l.電話}]),placeholder:"請輸入電話",rules:"required",modelValue:o.form.user.tel,"onUpdate:modelValue":t[4]||(t[4]=r=>o.form.user.tel=r)},null,8,["class","modelValue"]),i(f,{name:"電話",class:"invalid-feedback"})]),s("div",R,[t[14]||(t[14]=s("label",{for:"address",class:"form-label"},"收件人地址",-1)),i(h,{id:"address",name:"地址",type:"text",class:b(["form-control",{"is-invalid":l.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:o.form.user.address,"onUpdate:modelValue":t[5]||(t[5]=r=>o.form.user.address=r)},null,8,["class","modelValue"]),i(f,{name:"地址",class:"invalid-feedback"})]),s("div",W,[t[15]||(t[15]=s("label",{for:"message",class:"form-label"},"留言",-1)),v(s("textarea",{id:"message",class:"form-control",cols:"30",rows:"5","onUpdate:modelValue":t[6]||(t[6]=r=>o.form.message=r)},null,512),[[_,o.form.message]])]),t[16]||(t[16]=s("div",{class:"text-end"},[s("button",{class:"btn btn-danger"},"送出訂單")],-1))]),_:1},8,["onSubmit"])])])])}const st=q(U,[["render",X]]);export{st as default};
